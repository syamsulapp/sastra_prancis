<?php $icon2 = array('fa-glass','fa-music','fa-search','fa-envelope-o','fa-heart','fa-star','fa-star-o','fa-user','fa-film','fa-th-large','fa-th','fa-th-list','fa-check','fa-times','fa-search-plus','fa-search-minus','fa-power-off','fa-signal','fa-gear','fa-cog','fa-trash-o','fa-home','fa-file-o','fa-clock-o','fa-road','fa-download','fa-arrow-circle-o-down','fa-arrow-circle-o-up','fa-inbox','fa-play-circle-o','fa-rotate-right','fa-repeat','fa-refresh','fa-list-alt','fa-lock','fa-flag','fa-headphones','fa-volume-off','fa-volume-down','fa-volume-up','fa-qrcode','fa-barcode','fa-tag','fa-tags','fa-book','fa-bookmark','fa-print','fa-camera','fa-font','fa-bold','fa-italic','fa-text-height','fa-text-width','fa-align-left','fa-align-center','fa-align-right','fa-align-justify','fa-list','fa-dedent','fa-outdent','fa-indent','fa-video-camera','fa-picture-o','fa-pencil','fa-map-marker','fa-adjust','fa-tint','fa-edit','fa-pencil-square-o','fa-share-square-o','fa-check-square-o','fa-arrows','fa-step-backward','fa-fast-backward','fa-backward','fa-play','fa-pause','fa-stop','fa-forward','fa-fast-forward','fa-step-forward','fa-eject','fa-chevron-left','fa-chevron-right','fa-plus-circle','fa-minus-circle','fa-times-circle','fa-check-circle','fa-question-circle','fa-info-circle','fa-crosshairs','fa-times-circle-o','fa-check-circle-o','fa-ban','fa-arrow-left','fa-arrow-right','fa-arrow-up','fa-arrow-down','fa-mail-forward','fa-share','fa-expand','fa-compress','fa-plus','fa-minus','fa-asterisk','fa-exclamation-circle','fa-gift','fa-leaf','fa-fire','fa-eye','fa-eye-slash','fa-warning','fa-exclamation-triangle','fa-plane','fa-calendar','fa-random','fa-comment','fa-magnet','fa-chevron-up','fa-chevron-down','fa-retweet','fa-shopping-cart','fa-folder','fa-folder-open','fa-arrows-v','fa-arrows-h','fa-bar-chart-o','fa-twitter-square','fa-facebook-square','fa-camera-retro','fa-key','fa-gears','fa-cogs','fa-comments','fa-thumbs-o-up','fa-thumbs-o-down','fa-star-half','fa-heart-o','fa-sign-out','fa-linkedin-square','fa-thumb-tack','fa-external-link','fa-sign-in','fa-trophy','fa-github-square','fa-upload','fa-lemon-o','fa-phone','fa-square-o','fa-bookmark-o','fa-phone-square','fa-twitter','fa-facebook','fa-github','fa-unlock','fa-credit-card','fa-rss','fa-hdd-o','fa-bullhorn','fa-bell','fa-certificate','fa-hand-o-right','fa-hand-o-left','fa-hand-o-up','fa-hand-o-down','fa-arrow-circle-left','fa-arrow-circle-right','fa-arrow-circle-up','fa-arrow-circle-down','fa-globe','fa-wrench','fa-tasks','fa-filter','fa-briefcase','fa-arrows-alt','fa-group','fa-users','fa-chain','fa-link','fa-cloud','fa-flask','fa-cut','fa-scissors','fa-copy','fa-files-o','fa-paperclip','fa-save','fa-floppy-o','fa-square','fa-bars','fa-list-ul','fa-list-ol','fa-strikethrough','fa-underline','fa-table','fa-magic','fa-truck','fa-pinterest','fa-pinterest-square','fa-google-plus-square','fa-google-plus','fa-money','fa-caret-down','fa-caret-up','fa-caret-left','fa-caret-right','fa-columns','fa-unsorted','fa-sort','fa-sort-down','fa-sort-asc','fa-sort-up','fa-sort-desc','fa-envelope','fa-linkedin','fa-rotate-left','fa-undo','fa-legal','fa-gavel','fa-dashboard','fa-tachometer','fa-comment-o','fa-comments-o','fa-flash','fa-bolt','fa-sitemap','fa-umbrella','fa-paste','fa-clipboard','fa-lightbulb-o','fa-exchange','fa-cloud-download','fa-cloud-upload','fa-user-md','fa-stethoscope','fa-suitcase','fa-bell-o','fa-coffee','fa-cutlery','fa-file-text-o','fa-building-o','fa-hospital-o','fa-ambulance','fa-medkit','fa-fighter-jet','fa-beer','fa-h-square','fa-plus-square','fa-angle-double-left','fa-angle-double-right','fa-angle-double-up','fa-angle-double-down','fa-angle-left','fa-angle-right','fa-angle-up','fa-angle-down','fa-desktop','fa-laptop','fa-tablet','fa-mobile-phone','fa-mobile','fa-circle-o','fa-quote-left','fa-quote-right','fa-spinner','fa-circle','fa-mail-reply','fa-reply','fa-github-alt','fa-folder-o','fa-folder-open-o','fa-smile-o','fa-frown-o','fa-meh-o','fa-gamepad','fa-keyboard-o','fa-flag-o','fa-flag-checkered','fa-terminal','fa-code','fa-reply-all','fa-mail-reply-all','fa-star-half-empty','fa-star-half-full','fa-star-half-o','fa-location-arrow','fa-crop','fa-code-fork','fa-unlink','fa-chain-broken','fa-question','fa-info','fa-exclamation','fa-superscript','fa-subscript','fa-eraser','fa-puzzle-piece','fa-microphone','fa-microphone-slash','fa-shield','fa-calendar-o','fa-fire-extinguisher','fa-rocket','fa-maxcdn','fa-chevron-circle-left','fa-chevron-circle-right','fa-chevron-circle-up','fa-chevron-circle-down','fa-html5','fa-css3','fa-anchor','fa-unlock-alt','fa-bullseye','fa-ellipsis-h','fa-ellipsis-v','fa-rss-square','fa-play-circle','fa-ticket','fa-minus-square','fa-minus-square-o','fa-level-up','fa-level-down','fa-check-square','fa-pencil-square','fa-external-link-square','fa-share-square','fa-compass','fa-toggle-down','fa-caret-square-o-down','fa-toggle-up','fa-caret-square-o-up','fa-toggle-right','fa-caret-square-o-right','fa-euro','fa-eur','fa-gbp','fa-dollar','fa-usd','fa-rupee','fa-inr','fa-cny','fa-rmb','fa-yen','fa-jpy','fa-ruble','fa-rouble','fa-rub','fa-won','fa-krw','fa-bitcoin','fa-btc','fa-file','fa-file-text','fa-sort-alpha-asc','fa-sort-alpha-desc','fa-sort-amount-asc','fa-sort-amount-desc','fa-sort-numeric-asc','fa-sort-numeric-desc','fa-thumbs-up','fa-thumbs-down','fa-youtube-square','fa-youtube','fa-xing','fa-xing-square','fa-youtube-play','fa-dropbox','fa-stack-overflow','fa-instagram','fa-flickr','fa-adn','fa-bitbucket','fa-bitbucket-square','fa-tumblr','fa-tumblr-square','fa-long-arrow-down','fa-long-arrow-up','fa-long-arrow-left','fa-long-arrow-right','fa-apple','fa-windows','fa-android','fa-linux','fa-dribbble','fa-skype','fa-foursquare','fa-trello','fa-female','fa-male','fa-gittip','fa-sun-o','fa-moon-o','fa-archive','fa-bug','fa-vk','fa-weibo','fa-renren','fa-pagelines','fa-stack-exchange','fa-arrow-circle-o-right','fa-arrow-circle-o-left','fa-toggle-left','fa-caret-square-o-left','fa-dot-circle-o','fa-wheelchair','fa-vimeo-square','fa-turkish-lira','fa-try','fa-plus-square-o');?>
<div class="row">
	<!--label baru-->
	<div class="col-lg-4">
		<form name="form_tambah_label" id="form-tambah-label" method="post">
			<input name="id_label" id="id-label" type="hidden">
			<div class="form-group">
				<!-- Icon label (url) *icon 76px X 76px -->
				<div class="input-group">
					<input id="icon-menu" name="icon_menu" type="text" class="form-control square-btn-adjust" title="Icon menu" data-toggle="modal" data-target=".bs-gambar-andalan">
					<span class="input-group-addon"><i class="glyphicon glyphicon-picture" id="btn-gambar-pilih" data-toggle="modal" data-target=".bs-gambar-andalan"></i></span>
				</div>
			</div>
			<div class="form-group">
				<label>Nama</label>
				<input id="nama-label" name="nama_label" type="text" class="form-control square-btn-adjust required" title="Nama label">
			</div>
			<div class="form-group">
				<label>Kode</label>
				<input id="slug-label" name="slug_label" type="text" class="form-control square-btn-adjust required" title="Kode">
			</div>
			<div class="form-group">
				<label>Deskripsi</label>
				<textarea id="deskripsi-label" name="deskripsi_label" class="form-control square-btn-adjust" rows="5" title="Deskripsi label"></textarea>
			</div>
			<div class="form-group">
				<button type="reset" class="md-btn md-btn-default btn-sm square-btn-adjust" title="Batal/Reset Form" onclick="form_tambah_label_reset()"><li class="glyphicon glyphicon-floppy-remove"></li> Batal</button>
				<button type="submit" class="md-btn md-btn-primary btn-sm square-btn-adjust" title="Tambah label baru"><li class="glyphicon glyphicon-floppy-disk"></li> Tambah label Baru</button>
			</div>
		</form>
	</div>
	<!--label baru end-->

	<!--daftar label-->
	<div class="col-lg-8" style="border-left:1px solid #f0f0f0;">
		<form name="form_hapus_label_massal" id="form-hapus-label-massal" method="post">
		<div class="block" style="margin-bottom:30px;">
			<div class="form-group">
				<div style="float:left" class="row col-md-5">
					<div class="input-group">
						<select name="aksi_tindakan_massal_atas" class="form-control square-btn-adjust auto-width" title="Tindakan massal">
							<option>Tindakan Massal</option>
							<option value="hps">Hapus</option>
						</select>
						<span class="btn btn-default square-btn-adjust input-group-addon" title="Terapkan" onclick="submit('#form-hapus-label-massal');">Terapkan</span>
					</div>
				</div>
				<div style="float:right">
					<input id="cari-label" onkeypress="cari_label_()" onchange="cari_label_()" onblur="cari_label_()" name="cari_label" type="text" class="form-control square-btn-adjust" title="Cari label">
				</div>
				<br />
			</div>
		</div>
		<div class="table-responsive">
			<!--tabel label-->
			<table class="uk-table">
				<thead>
					<tr>
						<th width="5%" class="md-bg-grey-100"><input id="check-label-all-atas" onclick="check_label_all_atas()" type="checkbox"></th>
						<th width="35%" class="md-bg-grey-100">Nama</th>
						<th width="35%" class="md-bg-grey-100">Deskripsi</th>
						<th width="25%" class="md-bg-grey-100">Kode</th>
					</tr>
				</thead>
				<tbody id="tbody-label">
					<!--label-->
				</tbody>
				<tfoot>
					<tr>
						<th class="md-bg-grey-100"><input id="check-label-all-bawah" onclick="check_label_all_bawah()" type="checkbox"></th>
						<th class="md-bg-grey-100">Nama</th>
						<th class="md-bg-grey-100">Deskripsi</th>
						<th class="md-bg-grey-100">Kode</th>
					</tr>
				</tfoot>
			</table>
			<!--tabel label end-->
		</div>
		<div class="block" style="margin-top:10px;">
			<div class="form-group">
				<div style="float:left" class="row col-md-5">
					<div class="input-group">
						<select name="aksi_tindakan_massal_bawah" class="form-control square-btn-adjust auto-width" title="Tindakan massal">
							<option>Tindakan Massal</option>
							<option value="hps">Hapus</option>
						</select>
						<span class="btn btn-default square-btn-adjust input-group-addon" title="Terapkan" onclick="submit('#form-hapus-label-massal');">Terapkan</span>
					</div>
				</div>
				<div style="float:right">
					<i><gedank id="jml-list-bawah">0</gedank> label</i>
				</div>
			</div>
		</div>
		</form>
	</div>
	<!--daftar label end-->
</div>

<!--Gambar Andalan Modal-->
<div class="modal fade bs-gambar-andalan" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content square-btn-adjust">
			<div class="row">
				<div class="col-lg-12">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h3 class="modal-title">Pilih Icon</h3>
					</div>
					<div class="modal-body">
						<?php foreach($icon2 as $nama){ ?>
							<i class="fa fa-2x <?php echo$nama; ?>" title="<?php echo$nama; ?>" style="margin:5px" onclick="set_icon('<?php echo$nama; ?>')" data-dismiss="modal"></i>
						<?php } ?>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default square-btn-adjust" data-dismiss="modal">Tutup</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<!--Gambar Andalan Modal end-->

<script type="text/javascript" src="<?php echo base_url('assets/jquery/jquery-2.1.3.min.js');?>"></script>
<script type="text/javascript">
var penulis="<?php echo $this->session->userdata('level');?>";
var url='<?php echo site_url(); ?>';

$(window).load(function(){
	$.ajax({
        'url': '<?php echo site_url("label/getlabel");?>',
        'dataType': 'json',
        'success': function(data){
        	//console.log(data);
        	if(data.data!=null){
        		isi(data.data);
        	}
        }
    });

    form_tambah_label_reset();
});

$(document).ready(function(){

	$('#form-tambah-label').submit(function(e){
		e.preventDefault();
		$.ajax({
	        'type': 'POST',
	        'url': '<?php echo site_url("label/addlabel");?>',
	        'dataType': 'json',
	        'data': $(this).serialize(),
	        success: function(data){
	        	//console.log(data);
	        	if(data.data!=null){
					isi(data.data);
					var notification = alertify.notify(data.psn, data.wrng, 5, function(){});
                }else{
                    alertify.error('ERROR!');
                }
	        }
	    });
	    form_tambah_label_reset();
	});

	$('#form-hapus-label-massal').submit(function(e){
		e.preventDefault();
		$.ajax({
	        'type': 'POST',
	        'url': '<?php echo site_url("label/dellabelmassal");?>',
	        'dataType': 'json',
	        'data': $(this).serialize(),
	        success: function(data){
	        	//console.log(data);
	        	if(data.data!=null){
					isi(data.data);
					var notification = alertify.notify(data.psn, data.wrng, 5, function(){});
                }else{
                    alertify.error('ERROR!');
                }
	        }
	    });
	    form_tambah_label_reset();
	});
});

function cari_label_(){
	console.log($('#cari-label').val());
	$.ajax({
        'type': 'POST',
        'url': '<?php echo site_url("label/searchlabel");?>',
        'dataType': 'json',
        'data': 'cari_label='+$('#cari-label').val(),
        success: function(data){
        	//console.log(data);
        	if(data.data!=null){
				isi(data.data);
			}
        }
    });
    $('#check-label-all-bawah').prop('checked', false);
    $('#check-label-all-atas').prop('checked', false);
}

function form_tambah_label_reset(){
	$('#id-label').val('');
	$('#nama-label').val('');
	$('#slug-label').val('');
	$('#induk-label').val('0');
	$('#deskripsi-label').val('');
	$('#icon-menu').val('');
}

function row_actions_over(id){
	$('#row-actions-'+id).show();
	$('#br-'+id).hide();
}

function row_actions_blur(id){
	$('#row-actions-'+id).hide();
	$('#br-'+id).show();
}

function check_label_all_atas(){
	if(document.getElementById('check-label-all-atas').checked==true){
		$('.check-label').prop('checked', true);
		$('#check-label-all-bawah').prop('checked', true);
	}else{
		$('.check-label').prop('checked', false);
		$('#check-label-all-bawah').prop('checked', false);
	}
}

function check_label_all_bawah(){
	if(document.getElementById('check-label-all-bawah').checked==true){
		$('.check-label').prop('checked', true);
		$('#check-label-all-atas').prop('checked', true);
	}else{
		$('.check-label').prop('checked', false);
		$('#check-label-all-atas').prop('checked', false);
	}
}

function set_edit(data){
	$('#id-label').val(data.id);
	$('#nama-label').val(data.nm);
	$('#slug-label').val(data.slug);
	$('#induk-label option[value='+data.id_idk+']').prop('selected', true);
	$('#deskripsi-label').val(data.des);
	$('#icon-menu').val(data.icon);
}

function set_icon(nama){
	$('#icon-menu').val(nama);
}

function isi(data){
	//console.log(data);
	if(data.error==0){
		table = '';
		select_label = '<select id="induk-label" name="induk_label" class="form-control square-btn-adjust auto-width" title="Induk label">'
		select_label += '<option value="0">- label induk -</option>';
		$.each(data.label, function(i,n){
			select_label += '<option id="kat-'+n['id_kategori']+'" value="'+n['id_kategori']+'">'+n['kategori']+'</option>';

			table += '<tr id="hapus-row-label-'+n['id_kategori']+'" onmouseover="row_actions_over(\''+n['id_kategori']+'\')" onmouseout="row_actions_blur(\''+n['id_kategori']+'\')">'
				+'<td>';
				if(n['id_kategori']!='1'){
					table +='<input name="id_hapus_label_massal_['+n['id_kategori']+']" class="check-label" type="checkbox" value="'+n['id_kategori']+'">';
				}
				table +='</td>'
				+'<td><p>';
					if(n['icon']!=''){
						if(n['icon'].substr(0,2)=='fa'){
							table+='<i width="30px" height="30px" class="fa '+n['icon']+'" style="margin-right:10px"></i>';
						}else{
							table+='<img width="30px" height="30px" src="'+n['icon']+'" style="margin-right:10px">';
						}
					}
					table+=n['kategori']+'</p>'
					+'<br id="br-'+n['id_kategori']+'">'
					+'<div class="row-actions" id="row-actions-'+n['id_kategori']+'" style="display:none">'
						+'<span class="sunting"><a onclick="set_edit({'
							+'id:\''+n['id_kategori']
							+'\',nm:\''+n['kategori']
							+'\',slug:\''+n['slug']
							+'\',icon:\''+n['icon']
							+'\',id_idk:\''+n['parent']
							+'\',des:\''+n['deskripsi']
							+'\''
						+'})">Sunting</a></span>';
						if(n['id_kategori']!='1'){
							if(penulis=='administrator'){
								table +='<span class="hapus"> | <a title="Hapus '+n['kategori']+'" data-toggle="modal" data-target=".bs-hapus" onclick="set_del({id:\''+n['id_kategori']+'\',nm:\''+n['kategori']+'\',act:\''+url+'label/dellabel\',element:\'hapus-row-label-\'})">Hapus</a></span>'
							}
						}
						table +='<span class="tampilkan"> | <a target="blank" href="'+url+'lihat/label/'+n['slug']+'#li-'+n['id_kategori']+'">Tampilkan</a></span>'
					+'</div>'
				+'</td>'
				+'<td>'+n['deskripsi']+'</td>'
				+'<td>'+n['slug']+'</td>'
			+'</tr>';
			
			kat_id(n['id_kategori'],0);
		});
		select_label += '</select>';

		$("#induk-label").html(select_label);
		$("#tbody-label").html(table);
		$("#jml-list-bawah").html(0);
	}else{
		table = '';
			table += '<tr>'
				+'<td colspan="4">label tidak ditemukan.</td>'
			+'</tr>';
		table += '';
		$("#tbody-label").html(table);
	}
}

function kat_id(id,i){
	$.ajax({
        'type': 'POST',
        'url': '<?php echo site_url("label/getlabel");?>',
        'dataType': 'json',
        'data': 'id_kat='+id,
        success: function(data){
        	j=i+1;
        	select_label = '';
        	table = '';
			$.each(data.data.label, function(i,n){
				strip='';
				strip2='';
				for(k=0;k<j;k++){
					strip+='-';
					strip2+='<i class="fa fa-minus"></i> ';
				}
				select_label += '<option id="kat-'+n['id_kategori']+'" value="'+n['id_label']+'">'+strip+n['kategori']+'</option>';

				table += '<tr id="hapus-row-label-'+n['id_kategori']+'" onmouseover="row_actions_over(\''+n['id_kategori']+'\')" onmouseout="row_actions_blur(\''+n['id_kategori']+'\')">'
					+'<td>';
					if(n['id_kategori']!='1'){
						table +='<input name="id_hapus_label_massal_['+n['id_label']+']" class="check-label" type="checkbox" value="'+n['id_kategori']+'">';
					}
					table +='</td>'
					+'<td><p>'+strip2;
					if(n['icon']!=''){
						if(n['icon'].substr(0,2)=='fa'){
							table+='<i width="30px" height="30px" class="fa '+n['icon']+'" style="margin-right:10px"></i>';
						}else{
							table+='<img width="30px" height="30px" src="'+n['icon']+'" style="margin-right:10px">';
						}
					}
					table+=n['kategori']+'</p>'
						+'<br id="br-'+n['id_label']+'">'
						+'<div class="row-actions" id="row-actions-'+n['id_label']+'">'
							+'<span class="sunting"><a onclick="set_edit({'
								+'id:\''+n['id_kategori']
								+'\',nm:\''+n['kategori']
								+'\',slug:\''+n['slug']
								+'\',icon:\''+n['icon']
								+'\',id_idk:\''+n['parent']
								+'\',des:\''+n['deskripsi']
								+'\''
							+'})">Sunting</a></span>';
							if(n['id_label']!='1'){
								if(penulis=='administrator'){
									table +='<span class="hapus"> | <a title="Hapus '+n['kategori']+'" data-toggle="modal" data-target=".bs-hapus" onclick="set_del({id:\''+n['id_kategori']+'\',nm:\''+n['kategori']+'\',act:\''+url+'label/dellabel\',element:\'hapus-row-label-\'})">Hapus</a></span>'
								}
							}
							table +='<span class="tampilkan"> | <a target="blank" href="'+url+'lihat/label/'+n['slug']+'#li-'+n['id_kategori']+'">Tampilkan</a></span>'
						+'</div>'
					+'</td>'
					+'<td>'+n['deskripsi']+'</td>'
					+'<td>'+n['slug']+'</td>'
				+'</tr>';

				kat_id(n['id_kategori'],j);
			});
			$(select_label).insertAfter("#kat-"+id);

			$(table).insertAfter("#hapus-row-label-"+id);

			$("#jml-list-bawah").html(eval($("#jml-list-bawah").html())+1);
        }
    });
}
</script>